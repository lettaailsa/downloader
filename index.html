<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>TikDownload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/jpeg" href="https://kiracloud.my.id/KC9K.jpeg" />
  <style>
    :root {
      --bg: #000;
      --card: #0a0a0a;
      --accent: #888;
      --accent2: #fff;
      --radius: 12px;
    }
    * { box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Roboto,Arial,sans-serif }
    body {
      background:var(--bg);
      color:#fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      padding:20px;
    }
    h1 {
      font-size:2rem;
      font-weight:700;
      letter-spacing:1px;
      margin-bottom:25px;
      color:var(--accent2);
      text-transform:uppercase;
      text-align:center;
    }
    .selector { display:flex; gap:10px; justify-content:center; margin-bottom:25px; flex-wrap:wrap; }
    .selector button { padding:12px 20px; border:none; border-radius:var(--radius); background:linear-gradient(135deg,#222,#111); color:#fff; font-size:1rem; cursor:pointer; transition:.3s; }
    .selector button:hover { background:linear-gradient(135deg,#444,#222); transform:translateY(-2px); }
    .selector button.active { background:linear-gradient(135deg,#555,#333); box-shadow:0 0 10px rgba(255,255,255,0.2) }
    .card { background:var(--card); border-radius:var(--radius); padding:25px; width:100%; max-width:480px; text-align:center; box-shadow:0 0 25px rgba(255,255,255,0.08); display:none; animation:fadeIn 0.5s ease; }
    .card.active { display:block }
    input[type=url] {
      width:100%;
      max-width:480px;
      margin:0 auto;
      display:block;
      padding:12px 15px;
      border:none;
      border-radius:var(--radius);
      font-size:1rem;
      margin-bottom:15px;
      background:#111;
      color:#fff;
      outline:1px solid #333;
      transition:.3s;
    }
    input[type=url]:focus { outline:1px solid var(--accent); }
    button.download { width:100%; padding:12px; background:linear-gradient(135deg,#333,#111); color:#fff; border:none; border-radius:var(--radius); font-size:1rem; cursor:pointer; transition:0.3s; }
    button.download:hover { background:linear-gradient(135deg,#555,#222); transform:translateY(-2px); }
    .loading { margin:15px 0; font-size:0.95rem; color:#aaa; display:none; }
    .result { display:none; margin-top:20px; background:#111; border-radius:var(--radius); padding:15px; box-shadow:inset 0 0 10px rgba(255,255,255,0.05); animation:fadeIn 0.5s ease; }
    .result img { width:100%; border-radius:var(--radius); margin-bottom:10px; }
    .dlbtn { display:block; margin:8px 0; padding:10px; background:#222; border-radius:var(--radius); text-align:center; color:#fff; cursor:pointer; text-decoration:none; border:none; width:100%; }
    .dlbtn:hover { background:#333; }
    footer { margin-top:30px; font-size:0.8rem; color:#777; text-align:center; }
    @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }
  </style>
</head>
<body>

  <h1>TikDownload</h1>

  <div class="selector">
    <button id="btnTT" onclick="selectTab('tt')">TikTok</button>
    <button id="btnIG" onclick="selectTab('ig')">Instagram</button>
  </div>

  <!-- Instagram -->
  <div class="card" id="card-ig">
    <p style="color:#777;margin-bottom:10px;">Unduh foto & video dari Instagram</p>
    <input id="ig-url" type="url" placeholder="https://www.instagram.com/p/xxxxx">
    <button class="download" onclick="dlIG()">Download</button>
    <div class="loading" id="ig-load">⏳ Mengambil data...</div>
    <div class="result" id="ig-res"></div>
  </div>

  <!-- TikTok -->
  <div class="card" id="card-tt">
    <p style="color:#777;margin-bottom:10px;">Unduh video TikTok tanpa watermark</p>
    <input id="tt-url" type="url" placeholder="https://vt.tiktok.com/xxxxx">
    <button class="download" onclick="dlTT()">Download</button>
    <div class="loading" id="tt-load">⏳ Mengambil data...</div>
    <div class="result" id="tt-res">
      <img id="tt-thumb" alt="Thumbnail">
      <h4 id="tt-title"></h4>
      <button class="dlbtn" id="tt-hd">Download HD</button>
      <button class="dlbtn" id="tt-sd">Download SD</button>
      <button class="dlbtn" id="tt-mp3">Download Audio</button>
    </div>
  </div>

  <footer>© 2025 TikDownload</footer>

  <script>
    const buttons = {
      ig: document.getElementById('btnIG'),
      tt: document.getElementById('btnTT')
    };

    function selectTab(tab) {
      ['ig','tt'].forEach(x => {
        document.getElementById('card-'+x).classList.remove('active');
        buttons[x].classList.remove('active');
      });
      document.getElementById('card-'+tab).classList.add('active');
      buttons[tab].classList.add('active');
    }
    selectTab('tt'); // default tab

    const proxyBase = '/proxy';

    const rand6 = () => Math.floor(100000 + Math.random() * 900000);

    const inferExtension = (url, type='') => {
      if (/\.(mp4|mov|webm|m4v)(\?|$)/i.test(url)) return 'mp4';
      if (/\.(mp3|aac|m4a)(\?|$)/i.test(url)) return 'mp3';
      if (/\.(png|jpg|jpeg|webp|gif)(\?|$)/i.test(url)) return RegExp.$1;
      if (/audio/.test(type)) return 'mp3';
      if (/video/.test(type)) return 'mp4';
      if (/image/.test(type)) return 'jpg';
      return 'bin';
    };

    const buildFilename = (type, res, url, ct) => {
      const rnd = rand6();
      const ext = inferExtension(url, ct);
      const suf = res ? '-' + res.toUpperCase() : '';
      return `TikDownload_${rnd}${suf}.${ext}`;
    };

    async function handleDownload(fileUrl, filename) {
      try {
        const res = await fetch(fileUrl);
        const blob = await res.blob();
        const blobUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(blobUrl), 5_000);
      } catch {
        window.open(fileUrl, '_blank');
      }
    }

    async function dlIG() {
      const url = document.getElementById('ig-url').value.trim();
      const resBox = document.getElementById('ig-res');
      const load = document.getElementById('ig-load');
      if (!url) return alert('Masukkan link Instagram!');
      resBox.innerHTML = '';
      load.style.display = 'block';

      try {
        const api = `https://api.nvidiabotz.xyz/download/instagram?url=${encodeURIComponent(url)}`;
        const res = await fetch(api);
        const json = await res.json();
        if (!json.status || !json.result) throw new Error('Gagal ambil data');

        const entries = [];
        (Array.isArray(json.result) ? json.result : [json.result]).forEach(e => {
          if (Array.isArray(e.media)) e.media.forEach(m => entries.push(m));
          else if (Array.isArray(e.files)) e.files.forEach(m => entries.push(m));
          else entries.push(e);
        });

        entries.forEach(entry => {
          const allUrls = [entry.url, entry.url_download, entry.src, entry.file, entry.video, entry.display_url, entry.media_url].filter(Boolean);
          const mediaUrl = allUrls.find(u => typeof u === 'string' && u.startsWith('http')) || '';
          const thumb = entry.thumbnail || entry.preview || entry.thumb || entry.display_url || mediaUrl;
          const type = entry.contentType || entry.type || '';
          const mediaType = entry.media_type || entry.mediaType || '';
          const isVideo =
            entry.is_video === true ||
            /video/i.test(type) ||
            /video/i.test(mediaType) ||
            /\.(mp4|webm|mov|m4v)(\?|$)/i.test(mediaUrl);
          const filename = buildFilename(isVideo ? 'video' : 'image', '', mediaUrl, type);

          const div = document.createElement('div');
          div.style.marginBottom = '15px';
          div.style.textAlign = 'left';
          const img = document.createElement('img');
          img.src = thumb;
          img.style.borderRadius = '10px';
          div.appendChild(img);

          const btn = document.createElement('button');
          btn.className = 'dlbtn';
          btn.textContent = isVideo ? 'Download Video' : 'Download Image';
          btn.onclick = () => handleDownload(mediaUrl, filename);
          div.appendChild(btn);

          resBox.appendChild(div);
        });

        resBox.style.display = 'block';
      } catch (e) {
        alert(e.message || 'Server error');
      } finally {
        load.style.display = 'none';
      }
    }

    async function dlTT() {
      const url = document.getElementById('tt-url').value.trim();
      const load = document.getElementById('tt-load');
      const result = document.getElementById('tt-res');
      if (!url) return alert('Masukkan link TikTok!');
      load.style.display = 'block';
      result.style.display = 'none';
      try {
        const api = `https://api.nvidiabotz.xyz/download/tiktok?url=${encodeURIComponent(url)}`;
        const res = await fetch(api);
        const json = await res.json();
        if (!json.status) throw new Error(json.message || 'Gagal');
        const { video_hd, video_sd, mp3, thumbnail, title } = json.result;
        document.getElementById('tt-thumb').src = thumbnail || '';
        document.getElementById('tt-title').textContent = title || '';
        const hd = document.getElementById('tt-hd');
        const sd = document.getElementById('tt-sd');
        const aud = document.getElementById('tt-mp3');
        hd.style.display = video_hd ? 'block' : 'none';
        sd.style.display = video_sd ? 'block' : 'none';
        aud.style.display = mp3 ? 'block' : 'none';
        if (video_hd) hd.onclick = () => handleDownload(video_hd, buildFilename('tt', 'HD', video_hd));
        if (video_sd) sd.onclick = () => handleDownload(video_sd, buildFilename('tt', 'SD', video_sd));
        if (mp3) aud.onclick = () => handleDownload(mp3, buildFilename('tt', '', mp3));
        result.style.display = 'block';
      } catch (e) {
        alert(e.message);
      } finally {
        load.style.display = 'none';
      }
    }
  </script>
</body>
</html>

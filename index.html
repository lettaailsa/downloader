<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>TikDownload</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/jpeg" href="https://kiracloud.my.id/KC9K.jpeg" />
  <style>
    :root {
      --bg: #000;
      --card: #0a0a0a;
      --accent: #888;
      --accent2: #fff;
      --radius: 12px;
      --green: #28a745;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
    }

    body {
      background: var(--bg);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 25px;
      color: var(--accent2);
      text-transform: uppercase;
      text-align: center;
    }

    .selector {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .selector button {
      padding: 12px 20px;
      border: none;
      border-radius: var(--radius);
      background: linear-gradient(135deg, #222, #111);
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      transition: .3s;
    }

    .selector button:hover {
      background: linear-gradient(135deg, #444, #222);
      transform: translateY(-2px);
    }

    .selector button.active {
      background: linear-gradient(135deg, #555, #333);
      box-shadow: 0 0 10px rgba(255,255,255,0.2);
    }

    .card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 25px;
      width: 100%;
      max-width: 900px;
      text-align: center;
      box-shadow: 0 0 25px rgba(255,255,255,0.08);
      display: none;
      animation: fadeIn 0.5s ease;
    }

    .card.active {
      display: block;
    }

    input[type=url] {
      width: 100%;
      padding: 12px 15px;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      margin-bottom: 15px;
      background: #111;
      color: #fff;
      outline: 1px solid #333;
      transition: .3s;
    }

    input[type=url]:focus {
      outline: 1px solid var(--accent);
    }

    button.download {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #333, #111);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      cursor: pointer;
      transition: 0.3s;
    }

    button.download:hover {
      background: linear-gradient(135deg, #555, #222);
      transform: translateY(-2px);
    }

    .loading {
      margin: 15px 0;
      font-size: 0.95rem;
      color: #aaa;
      display: none;
    }

    .result {
      display: none;
      margin-top: 20px;
      background: #111;
      border-radius: var(--radius);
      padding: 15px;
      box-shadow: inset 0 0 10px rgba(255,255,255,0.05);
      animation: fadeIn 0.5s ease;
    }

    .result img {
      width: 100%;
      border-radius: var(--radius);
      margin-bottom: 10px;
    }

    .dlbtn {
      display: block;
      margin: 8px 0;
      padding: 10px;
      background: #222;
      border-radius: var(--radius);
      text-align: center;
      color: #fff;
      cursor: pointer;
      text-decoration: none;
      border: none;
      width: 100%;
    }

    .dlbtn:hover {
      background: #333;
    }

    footer {
      margin-top: 30px;
      font-size: 0.8rem;
      color: #777;
      text-align: center;
    }

    /* grid untuk banyak gambar */
    .media-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 14px;
      margin-top: 12px;
    }

    .media-item {
      background: #0f0f0f;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      padding-bottom: 10px;
    }

    .media-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 10px 10px 0 0;
    }

    .media-item button {
      width: calc(100% - 20px);
      margin: 10px auto 0;
      display: block;
      background: var(--green);
      color: #fff;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      padding: 10px 0;
      cursor: pointer;
      transition: 0.3s;
    }

    .media-item button:hover {
      background: #1e8d38;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

  <h1>TikDownload</h1>

  <div class="selector">
    <button id="btnTT" onclick="selectTab('tt')">TikTok</button>
    <button id="btnIG" onclick="selectTab('ig')">Instagram</button>
  </div>

  <!-- Instagram -->
  <div class="card" id="card-ig">
    <p style="color:#777;margin-bottom:10px;">Unduh foto & video dari Instagram</p>
    <input id="ig-url" type="url" placeholder="https://www.instagram.com/p/xxxxx">
    <button class="download" onclick="dlIG()">Download</button>
    <div class="loading" id="ig-load">⏳ Mengambil data...</div>
    <div class="result" id="ig-res"></div>
  </div>

  <!-- TikTok -->
  <div class="card" id="card-tt">
    <p style="color:#777;margin-bottom:10px;">Unduh video TikTok tanpa watermark</p>
    <input id="tt-url" type="url" placeholder="https://vt.tiktok.com/xxxxx">
    <button class="download" onclick="dlTT()">Download</button>
    <div class="loading" id="tt-load">⏳ Mengambil video...</div>
    <div class="result" id="tt-res">
      <img id="tt-thumb" alt="Thumbnail">
      <h4 id="tt-title"></h4>
      <button class="dlbtn" id="tt-hd">Download HD</button>
      <button class="dlbtn" id="tt-sd">Download SD</button>
      <button class="dlbtn" id="tt-mp3">Download Audio</button>
    </div>
  </div>

  <footer>© 2025 TikDownload</footer>

  <script>
    const buttons = {
      ig: document.getElementById('btnIG'),
      tt: document.getElementById('btnTT')
    };

    function selectTab(tab) {
      ['ig','tt'].forEach(x => {
        document.getElementById('card-'+x).classList.remove('active');
        buttons[x].classList.remove('active');
      });
      document.getElementById('card-'+tab).classList.add('active');
      buttons[tab].classList.add('active');
    }
    selectTab('tt');

    // --- UTILITAS ---
    const proxyBase = '/proxy';
    function rand6() { return Math.floor(100000 + Math.random() * 900000); }

    function inferExtension(url, contentType) {
      try {
        const u = new URL(url);
        const path = u.pathname;
        const match = path.match(/\.([a-z0-9]{2,5})(?:$|\?)/i);
        if (match) return match[1].toLowerCase();
      } catch(e){}
      if (contentType) {
        const ct = contentType.toLowerCase();
        if (ct.includes('mp4')) return 'mp4';
        if (ct.includes('jpeg') || ct.includes('jpg')) return 'jpg';
        if (ct.includes('png')) return 'png';
      }
      return 'bin';
    }

    function buildFilename(type, res, url, ct) {
      const ext = inferExtension(url, ct);
      return `TikDownload_${type}_${rand6()}.${ext}`;
    }

    async function handleDownload(url, name) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error('Failed');
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = name;
        a.click();
        URL.revokeObjectURL(a.href);
      } catch(e) {
        window.open(url, '_blank');
      }
    }

    function isImage(url) {
      return /\.(jpg|jpeg|png|webp|gif)/i.test(url);
    }

    // --- INSTAGRAM DOWNLOADER ---
    async function dlIG() {
      const url = document.getElementById('ig-url').value.trim();
      const load = document.getElementById('ig-load');
      const resEl = document.getElementById('ig-res');

      if (!url) return alert('Masukkan link Instagram!');
      resEl.innerHTML = '';
      load.style.display = 'block';

      try {
        const api = `https://api.nvidiabotz.xyz/download/instagram?url=${encodeURIComponent(url)}`;
        const res = await fetch(api);
        const json = await res.json();
        if (!json.status) throw new Error('Gagal mengambil data');

        const data = json.result;

        // === kalau hanya 1 video ===
        if (data.length === 1 && !isImage(data[0].url_download)) {
          const vid = data[0];
          const container = document.createElement('div');
          const img = document.createElement('img');
          img.src = vid.thumbnail;
          container.appendChild(img);

          const btn = document.createElement('button');
          btn.className = 'dlbtn';
          btn.textContent = 'Download Video';
          btn.onclick = () => handleDownload(vid.url_download, buildFilename('video','',vid.url_download));
          container.appendChild(btn);

          resEl.appendChild(container);
        } 
        // === kalau ada beberapa gambar ===
        else {
          const grid = document.createElement('div');
          grid.className = 'media-grid';
          const batch = [];

          data.forEach((item, i) => {
            const box = document.createElement('div');
            box.className = 'media-item';

            const img = document.createElement('img');
            img.src = item.url_download;
            box.appendChild(img);

            const btn = document.createElement('button');
            btn.textContent = 'Download Image';
            const name = buildFilename('image','',item.url_download);
            btn.onclick = () => handleDownload(item.url_download, name);
            box.appendChild(btn);

            grid.appendChild(box);
            batch.push({url:item.url_download, name});
          });

          resEl.appendChild(grid);

          // tombol Download All
          const allBtn = document.createElement('button');
          allBtn.className = 'dlbtn';
          allBtn.style.marginTop = '15px';
          allBtn.textContent = 'Download All';
          allBtn.onclick = async () => {
            for (const f of batch) await handleDownload(f.url, f.name);
          };
          resEl.appendChild(allBtn);
        }

        resEl.style.display = 'block';
      } catch(e) {
        alert(e.message);
      } finally {
        load.style.display = 'none';
      }
    }

    // --- TIKTOK DOWNLOADER ---
    async function dlTT() {
      const url = document.getElementById('tt-url').value.trim();
      const load = document.getElementById('tt-load');
      const result = document.getElementById('tt-res');
      if (!url) return alert('Masukkan link TikTok!');
      load.style.display = 'block';
      result.style.display = 'none';

      try {
        const api = `https://api.nvidiabotz.xyz/download/tiktok?url=${encodeURIComponent(url)}`;
        const res = await fetch(api);
        const json = await res.json();
        if (!json.status) throw new Error(json.message || 'Gagal');
        const { video_hd, video_sd, mp3, thumbnail, title } = json.result;

        document.getElementById('tt-thumb').src = thumbnail || '';
        document.getElementById('tt-title').textContent = title || '';

        const hdBtn = document.getElementById('tt-hd');
        if (video_hd) {
          hdBtn.style.display = 'block';
          hdBtn.onclick = () => handleDownload(video_hd, buildFilename('tt','hd',video_hd));
        } else hdBtn.style.display = 'none';

        const sdBtn = document.getElementById('tt-sd');
        if (video_sd) {
          sdBtn.style.display = 'block';
          sdBtn.onclick = () => handleDownload(video_sd, buildFilename('tt','sd',video_sd));
        } else sdBtn.style.display = 'none';

        const mp3Btn = document.getElementById('tt-mp3');
        if (mp3) {
          mp3Btn.style.display = 'block';
          mp3Btn.onclick = () => handleDownload(mp3, buildFilename('mp3','',mp3));
        } else mp3Btn.style.display = 'none';

        result.style.display = 'block';
      } catch(e) {
        alert(e.message);
      } finally {
        load.style.display = 'none';
      }
    }
  </script>
</body>
</html>
